# คู่มือการใช้งานระบบ ai-shop (สำหรับเจ้าของร้าน)

เอกสารนี้อธิบาย **วิธีใช้ระบบหลัง deploy เสร็จแล้ว** — ตั้งแต่สร้างร้านครั้งแรก จนถึงรับออเดอร์ผ่าน WhatsApp

---

## ภาพรวมระบบ

- **หน้าร้าน (ที่ลูกค้าเห็น)** = หน้าแรกแสดงสินค้า, กดเข้าไปดูรายละเอียด แล้วกดสั่ง → ได้ลิงก์แชร์ไป WhatsApp
- **Admin (ที่เจ้าของร้านใช้)** = เข้าสู่ระบบแล้วจัดการ ร้าน, หมวดหมู่, สินค้า, เลข WhatsApp, ออเดอร์

หลัง deploy คุณจะได้:
- **หน้าร้าน (ลูกค้า):** `https://ชื่อโปรเจกต์.pages.dev` — เปิดดูร้าน/สินค้า
- **หลังบ้าน (Admin):** `https://ชื่อโปรเจกต์.xxx.workers.dev/admin` — Bootstrap, Login, ตั้งค่าร้าน/สินค้า/ออเดอร์
- **API:** อยู่ที่ Worker เดียวกับ Admin

ปุ่ม **Admin** บนหน้าร้านจะลิงก์ไปที่ Worker `/admin` (ต้องตั้ง `NEXT_PUBLIC_ADMIN_URL` ใน Pages)

---

## ขั้นที่ 1: สร้าง user แรก (ทำครั้งเดียว)

ระบบจะให้สร้างร้านและบัญชีผู้ดูแลได้**ครั้งเดียว** เมื่อยังไม่มี user ในระบบ

1. เปิด **URL หลังบ้าน (Worker)** เช่น `https://ai-shop-api.xxx.workers.dev`  
   (จะถูกพาไป `/admin` อัตโนมัติ)
2. ที่หน้าเข้าสู่ระบบ ให้กด **「สร้างร้านและบัญชีแรก」**  
   หรือเข้า `/admin/bootstrap` โดยตรง
3. กรอกตามคำแนะนำบนหน้า:

   | ช่อง | ใส่อย่างไร |
   |-----|------------|
   | **Domain** | **สำคัญ:** ต้องเป็นโดเมนที่ระบบใช้เวลาเรียก API — ถ้าเว็บอยู่ **Pages** และ API อยู่ **Worker** (คนละโดเมน) ให้ใส่โดเมนของ **Worker** (เช่น `ai-shop-api.xxx.workers.dev`) ไม่ใช่โดเมนของหน้าเว็บ ฟิลด์นี้จะพยายามเติมให้อัตโนมัติถ้าตั้งค่า API URL ไว้แล้ว |
   | **Shop Name (Lao)** | ชื่อร้านภาษาลาว |
   | **Shop Name (English)** | ชื่อร้านภาษาอังกฤษ |
   | **Owner Email** | อีเมลที่ใช้เข้าสู่ระบบ Admin |
   | **Password** | รหัสผ่าน (อย่างน้อย 8 ตัว) |

4. กด **Create Shop**
5. หลังสร้างเสร็จ จะถูกพาไปหน้า **Login**

> **ถ้าเห็นข้อความ `D1_ERROR: no such table: users`:** ยังไม่ได้รัน schema ใน D1 — ไปที่ Cloudflare Dashboard → D1 → เลือกฐานข้อมูล → แท็บ **Console** → copy เนื้อหาจาก `schema/schema.sql` วางแล้วกด Execute หรือรันจากเครื่อง: `npm run db:schema`  
> ถ้าไม่เห็นหน้า Create First Shop แต่เห็นหน้า Login แปลว่ามีร้านและ user แล้ว — ให้ใช้ขั้นที่ 2 เลย

---

## ขั้นที่ 2: เข้าสู่ระบบ Admin

1. เปิด URL หน้าเว็บ แล้วคลิก **Admin** (หรือเข้า `/admin/login`)
2. กรอก **อีเมล** และ **รหัสผ่าน** ที่ตั้งไว้ตอน Bootstrap
3. กด **Login**
4. เข้าแล้วจะเห็นเมนูซ้าย: Dashboard, Shop, Products, Orders, Categories, WhatsApp

---

## ขั้นที่ 3: ตั้งค่าข้อมูลร้าน (Shop)

1. ใน Admin คลิก **Shop**
2. ตั้งค่าได้ดังนี้:
   - **Avatar / Cover** = รูปโปรไฟล์และรูปปกร้าน (อัปโหลดได้)
   - **Name (Lao / English)** = ชื่อร้าน
   - **Description** = คำอธิบายร้าน
   - **Theme Primary / Secondary** = สีประจำร้าน (จะไปโผล่ที่หน้าร้าน)
   - **WhatsApp Template** = ข้อความ template ที่จะส่งไป WhatsApp ตอนลูกค้ากดสั่ง (มีตัวแปรเช่น `{{product_name}}`, `{{qty}}`, `{{customer_name}}`, `{{customer_phone}}` ฯลฯ)
3. กด **Save** เมื่อแก้เสร็จ

---

## ขั้นที่ 4: เพิ่มเลข WhatsApp

ลูกค้าสั่งสินค้าแล้วจะได้ลิงก์แชร์ไป WhatsApp — ต้องมี **อย่างน้อยหนึ่งเลข** ที่ระบบรู้จัก

1. ใน Admin คลิก **WhatsApp**
2. กดเพิ่มเลข: ใส่ **Label** (เช่น "เบอร์หลัก"), **เบอร์รูปแบบ E.164** (เช่น `+8562012345678`)
3. เลือก **Default** ได้หนึ่งเลข (ใช้เป็นตัวเลือกหลักตอนลูกค้าสั่ง)
4. บันทึก

---

## ขั้นที่ 5: สร้างหมวดหมู่ (ไม่บังคับ)

ถ้าอยากจัดสินค้าเป็นหมวด (เช่น เครื่องดื่ม, ของกิน):

1. คลิก **Categories**
2. กดเพิ่ม: ใส่ชื่อ Lao / English
3. เรียงลำดับได้

---

## ขั้นที่ 6: เพิ่มสินค้า

1. คลิก **Products**
2. กด **Add product** (หรือไปที่ Products แล้วสร้างใหม่)
3. กรอก:
   - **Slug** = ข้อความสั้นใช้ใน URL (เช่น `green-tea`) — ระบบอาจเติมให้จากชื่อ
   - **Name (Lao / English)**
   - **Description**
   - **Price**
   - **Status** = Draft (ยังไม่โชว์) หรือ Published (โชว์ที่หน้าร้าน)
   - **Category** (ถ้ามี)
4. อัปโหลดรูปสินค้า, เลือกรูปปก
5. ถ้าต้องการตัวเลือก (เช่น Size S/M/L): ใช้ส่วน Option groups ในหน้าแก้สินค้า
6. กด **Save**

อย่าลืมเปลี่ยน Status เป็น **Published** ถ้าอยากให้ลูกค้าเห็น

---

## ขั้นที่ 7: ดูออเดอร์

1. คลิก **Orders**
2. จะเห็นรายการสั่งซื้อ: ลูกค้า, สินค้า, จำนวน, สถานะ (new / contacted / done / canceled)
3. สามารถเปลี่ยนสถานะและ export เป็น CSV ได้

---

## ฝั่งลูกค้า: ใช้ยังไง

1. ลูกค้าเปิด **URL หน้าร้าน** (โดเมนเดียวกับที่คุณใส่ตอน Bootstrap)
2. เห็นหน้าร้าน + สินค้า (ที่ตั้งเป็น Published)
3. คลิกสินค้า → ใส่ชื่อ, เบอร์, ที่อยู่ (และตัวเลือกถ้ามี) → กดสั่ง
4. ระบบจะให้ **ลิงก์แชร์ไป WhatsApp** — ลูกค้าแชร์ไปเบอร์ที่คุณตั้งไว้ คุณรับออเดอร์ทาง WhatsApp แล้วจัดการต่อใน Admin ได้

---

## สรุปลำดับที่แนะนำ (ครั้งแรก)

1. เปิด URL หน้าเว็บ → ไป **/admin/bootstrap** → สร้างร้าน + อีเมล/รหัสผ่าน  
2. **Login** ที่ /admin/login  
3. ตั้งค่า **Shop** (ชื่อ, รูป, สี, WhatsApp template)  
4. เพิ่ม **WhatsApp** อย่างน้อย 1 เบอร์  
5. (ถ้าต้องการ) สร้าง **Categories**  
6. เพิ่ม **Products** แล้วตั้งเป็น Published  
7. เปิด URL หน้าร้านในอีกแท็บ ตรวจว่าเห็นร้านและสินค้า  
8. ทดลองสั่งหนึ่งออเดอร์ แล้วดูใน **Orders** และลิงก์ WhatsApp  

ถ้าทำครบตามนี้ แสดงว่าระบบใช้งานได้ครบวงจรแล้ว
